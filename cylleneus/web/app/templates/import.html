{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center pt-4">
    <div class="col-md-9">
        <div class="card">
            <h5 class="card-header font-weight-bold">Import a text</h5>
            <div class="card-body">
                <form action="/import" method="POST" enctype="multipart/form-data">
                    <div class="form-group">
                        <label class="h6 font-weight-bold" for="author">Author</label>
                        <input type="text"
                               class="form-control"
                               name="author"
                               autocomplete="off"
                               value="{{ author }}"
                               placeholder=""
                               required="required"
                               id="author"/>
                    </div>
                    <div class="form-group">
                        <label class="h6 font-weight-bold" for="title">Title</label>
                        <input type="text"
                               class="form-control"
                               name="title"
                               autocomplete="off"
                               value="{{ title }}"
                               placeholder=""
                               required="required"
                               id="title"/>
                    </div>
                    <div class="form-group">
                        <p class="h6 font-weight-bold">Filename</p>
                        <div class="input-group">
                            <input type="file" required="required" class="form-control-file" name="file" id="file"
                                   aria-describedby="file">
                            <label id="file-label" class="custom-file-label" for="file"></label>
                        </div>
                        <div class="input-group">
                            <input name="content" type="text" id="content" value="{{ content }}" style="display:none;"/>
                            <input name="filename" type="text" id="filename" value="{{ filename }}"
                                   style="display:none;"/>
                        </div>
                    </div>
                    {% if success %}
                    <div class="alert alert-warning alert-dismissible show" role="alert">
                        <strong>Success!</strong> {{ file}} has been added.
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    {% endif %}
                    <div class="form-group float-right pt-2">
                        <button type="submit" id="submit" value="Import" class="btn btn-primary">Import</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}
<script>
document.getElementById('file').addEventListener('change', getFile);
function getFile(event) {
	const input = event.target;
  var selectedFile = input.files[0];
  document.getElementById('file-label').innerHTML = selectedFile.name;
  document.getElementById('filename').value = selectedFile.name;
	  placeFileContent(
      document.getElementById('content'),
      selectedFile)
}
function placeFileContent(target, file) {
	readFileContent(file).then(content => {
  	target.value = content
  })
}
function readFileContent(file) {
	const reader = new FileReader();
    return new Promise((resolve, reject) => {
    reader.onload = event => resolve(event.target.result);
    reader.onerror = error => reject(error);
    reader.readAsText(file);
  })
}
</script>
